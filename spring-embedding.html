<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>自動描画されるグラフ</title>
    <script>
      const SVG_NS = "http://www.w3.org/2000/svg";

      let svg, svgPoint, plusButton;
      let plusButtonIsVisible = false;
      // type NodeId = int
      // type Node = { weight: int, x: int, y: int }
      // nodes :: Array<NodeId, Node>
      const nodes = [
        { weight: 1, x: 100, y: 100 }
      ];
      // graph :: Array<NodeId, Array<NodeId, number>>
      // 最初のノードは一つだけなので距離は0だけ。
      const graph = [
        [0]
      ];

      const getCursorPoint = (event) => {
        svgPoint.x = event.clientX;
        svgPoint.y = event.clientY;
        return svgPoint.matrixTransform(svg.getScreenCTM().inverse());
      }

      const drawNewNode = (node) => {
        const circle = document.createElementNS(SVG_NS, 'circle');
        circle.setAttribute('cx', node.x);
        circle.setAttribute('cy', node.y);
        circle.setAttribute('r', 25);
        circle.setAttribute('fill-opacity', 0);
        circle.setAttribute('stroke', 'black');
        circle.setAttribute('stroke-width', 2.5);
        svg.appendChild(circle);

        const outer = document.createElementNS(SVG_NS, 'circle');
        outer.setAttribute('cx', node.x);
        outer.setAttribute('cy', node.y);
        outer.setAttribute('r', 33);
        outer.setAttribute('fill', 'none');
        //outer.setAttribute('stroke-opacity', 0);
        outer.setAttribute('stroke', 'red');
        outer.setAttribute('stroke-width', 14);
        outer.addEventListener('mousemove', event => {
          plusButtonIsVisible = true;
          const cursorPoint = getCursorPoint(event);
          plusButton.setAttribute('x', cursorPoint.x - 20);
          plusButton.setAttribute('y', cursorPoint.y - 20);
          plusButton.setAttribute('visibility', 'visible');
        });
        outer.addEventListener('mouseleave', () => {
          plusButton.setAttribute('visibility', 'hidden');
          plusButtonIsVisible = false;
        });
        svg.appendChild(outer);

        const label = document.createElementNS(SVG_NS, 'text');
        label.setAttribute('x', node.x - 10);
        label.setAttribute('y', node.y + 10);
        label.setAttribute('font-size', 30);
        label.appendChild(document.createTextNode(node.weight.toString()));

        svg.appendChild(label);
      };
      const draw = () => {
        for (let i = 0 ; i < nodes.length; i++){
          drawNewNode(nodes[i]);
        }
      }
      const init = () => {
        svg = document.getElementById('graph');
        svgPoint = svg.createSVGPoint();
        plusButton = document.getElementById('plus-button');
        draw();
      }
    </script>
  </head>
  <body onload="init()">
    <h1>自動描画されるグラフ</h1>
    <svg id="graph" width="1000" height="1000" xmlns="http://www.w3.org/2000/svg">
      <svg stroke="#000" visibility="hidden" id="plus-button" x="30" y="30">
        <circle r="10" cx="25" cy="25" fill="none" stroke-width="2"/>
        <rect transform="translate(-5, 0)" x="25" y="25" width="10" height=".5" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
        <rect transform="translate(0, -5)" x="25" y="25" width=".5" height="10" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
      </svg>
    </svg>
  </body>
</html>
